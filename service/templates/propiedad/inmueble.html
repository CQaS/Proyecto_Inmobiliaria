{% extends 'layouts/base00.html' %}

{% load static %}

{% block content %}

<!-- ESTILO PAGINA MAS DETALLES DE INMUEBLE -->

<style>
    hr {
        border-color: rgb(183, 146, 91);
        width: 1035px;
        grid-column: 1/3;
    }

    .box {
        display: grid;
        /* grid-template-columns: repeat(2, 1fr); 
        grid-gap: 10px 10px;*/
        grid-template-columns: 80% 20%;
        justify-content: space-between;
        grid-gap: 10px;
    }

    .dir p {
        grid-column: 1/2;
        font-size: 30px;
        line-height: 30px;
        font-weight: bold;
        margin: 70px auto auto 300px;
    }

    .operacion {
        grid-column: 1/2;
        margin: 10px auto auto 300px;
        font-size: 20px;
        line-height: 30px;
        font-weight: bold;
        background-color: rgb(183, 146, 91);
        color: white;
        display: flex;
        align-items: center;
        width: 100%;
        border-radius: 5px;
    }

    .valor {
        grid-column: 1/2;
        display: inline-block;
        vertical-align: middle;
        margin: 10px auto auto 300px;
        font-size: 20px;
        line-height: 30px;
        font-weight: bold;
        border: 1px solid black;
        border-radius: 5px;
        width: 100%;
    }

    /* Carrusel de fotos de inmueble  */
    .carruselImagen {
        object-fit: cover;
        max-width: 100%;
        max-height: 100%;
        width: auto;
        height: auto;
    }


    div.carrusel {
        grid-column: 1/2;
        display: flex;
        justify-content: center;
        align-items: center;
        margin: 10px auto auto 300px;
        width: 100%;
        position: relative;
        padding: 10px;
        height: 50vh;
        max-height: 200px;

    }

    .botones {
        width: 35px;
        height: 35px;
        border-radius: 50%;
        background-color: rgba(0, 0, 0, .3);
        text-align: center;
        font-size: 30px;
        font-weight: bold;
        position: absolute;
        color: #fff;
        box-shadow: 0 0 10px rgba(255, 255, 255, .6);
        -webkit-transition: all 0.3s ease;
        -o-transition: all 0.3s ease;
        transition: all 0.3s ease;
        top: 45%;
    }

    @media only screen and (min-width:326px) {
        .botones {
            font-size: 20px;
            width: 50px;
            height: 50px;
            line-height: 50px;
        }

        div.carrusel {
            max-height: 100%;
            min-height: 500px;

        }
    }

    .botones:hover {
        cursor: pointer;
        box-shadow: 0 0 20px rgba(255, 255, 255, 1);
    }

    .atras {
        left: 2%;
    }

    .adelante {
        right: 2%;
    }

    .info-basica {
        grid-column: 1/2;
        margin: 10px auto auto 300px;
        font-size: 16px;
    }

    .info-basica label {
        display: block;
    }

    .sup-medidas {
        grid-column: 1/1;
        margin: 10px auto auto 300px;
        font-size: 16px;
    }


    .sup-medidas label {
        display: block;
    }

    .descripcion {
        grid-column: 1/1;
        margin: 10px auto auto 300px;
        font-size: 16px;
    }

    .servicios {
        grid-column: 1/1;
        margin: 10px auto auto 300px;
        font-size: 16px;
    }

    .servicios label {
        display: block;
    }

    .mapa {
        grid-column: 1/2;
        margin: 10px auto auto 300px;
        border: rgb(183, 146, 91);
        border-radius: 5px solid black;
        /* height: 50px;
        width: 100%; */

    }

    /* mientras carga el mapa muestra una animacion */
    @keyframes spin {
        0% {
            transform: rotate(0deg);
        }

        100% {
            transform: rotate(360deg);
        }
    }

    .loading-spinner {
        border: 4px solid rgba(255, 255, 255, 0.3);
        border-top: 4px solid #3498db;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 2s linear infinite;
        position: fixed;
        /* Posición fija para que se mantenga en el centro de la ventana */
        top: 50%;
        /* Centra verticalmente en relación con el borde superior de la ventana */
        left: 50%;
        /* Centra horizontalmente en relación con el borde izquierdo de la ventana */
        transform: translate(-50%, -50%);
        /* Centra exactamente el centro del elemento en el centro de la ventana */
        z-index: 999;
        /* Asegura que esté por encima de otros elementos */
        display: none;
        /* Oculta el elemento inicialmente */
    }
</style>
{% for D in detalle %}
<div class="box">
    <div class="dir">
        <p>{{  D.dir_inmueble  }}</p>
    </div>

    <div class="operacion">
        <p>{{ D.tipo_operacion }}</p>
    </div>

    <div class="valor">
        <p>U$S {{ D.valor_inmueble }}</p>
    </div>

    <div class="carrusel">
        <div class="atras botones">&#60;</div>
        <div class="adelante botones">&#62;</div>
        <img src="https://i.kinja-img.com/gawker-media/image/upload/s--w6bO7tA3--/c_scale,fl_progressive,q_80,w_800/811116324189419953.jpg"
            alt="" class="carruselImagen">
    </div>


    <div class="info-basica">
        <h3>INFORMACION BASICA</h3>
        <hr>
        <!-- va una table 2 columnas x 4 filas -->
        <label for="">Ciudad: {{ D.ciudad_inmueble }}</label>
        <label for="">Tipo Inmueble: {{ D.tipo_inmueble }}</label>
        <label for="">Cantidad Plantas: {{ D.cant_plantas }}</label>
        <label for="">Cantidad Dormitorios: {{ D.cant_dormitorios }}</label>
        <label for="">Cantidad Baños: {{ D.cant_banos }}</label>
    </div>

    <div class="sup-medidas">
        <h3>SUPERFIC"IES Y ADICIONALES</h3>
        <hr>

        <label for="">Sup. Total: {{ D.sup_total }}</label>
        <label for="">Sup. Cubierta: {{ D.sup_cubierta }}</label>
        <label for="">Sup. Semicubierta: {{ D.sup_semicub}}</label>
        <label for="">Cochera: {% if D.cochera %}SI{% else %}NO{% endif %}</label>
        <label for="">Expensas: {% if D.expensas %}SI{% else %}NO{% endif %}</label>
    </div>


    <div class="descripcion">
        <h3>DESCRIPCION</h3>
        <hr>
        <p>{{ D.descripcion }}</p>
    </div>

    <div class="servicios">
        <h3>SERVICIOS</h3>
        <hr>
        <label for=""> {{ D.tipo_servicio }} </label>

    </div>


    <div class="mapa">
        <h3>UBICACION</h3>
        <hr><br>
        <p id="location-info"></p>

        <div id="map" style="width: 800px; height: 400px;">
            <div id="loading-spinner" class="loading-spinner"></div>
        </div>
    </div>

    <!-- {-{ puntos|json_script:"puntos_json" }-} -->

    <!-- <div class="mapa">
        <h3>UBICACION</h3>
        <hr>
        <div id="map">
            <p>mapa de google
                Lorem ipsum dolor sit amet consectetur 
                adipisicing elit. 
                Laboriosam quisquam sunt 
                
               
            </p>
        </div>
        <script src="https://www.google.com/maps/@-33.0182225,-58.527254,15z?authuser=0&entry=ttu"></script>
    </div> -->
</div>
<script>
    //Arreglo de imagenes
    let pictures = [
        '/static/assets/img/prueba01.jpg',
        '/static/assets/img/prueba02.jpg',
        '/static/assets/img/prueba03.jpg',
        '/static/assets/img/prueba04.jpg',
        '/static/assets/img/prueba05.jpg',
        '/static/assets/img/prueba06.jpg',
        '/static/assets/img/prueba07.jpg'
    ];
    let contador = 0;

    function carrusel(contenedor) {
        contenedor.addEventListener('click', e => {
            let atras = contenedor.querySelector('.atras'),
                adelante = contenedor.querySelector('.adelante'),
                img = contenedor.querySelector('img'),
                tgt = e.target; //Identificar elemento que hace click
            console.log(tgt);
            if (tgt == atras) {
                if (contador > 0) {
                    img.src = pictures[contador - 1];
                    contador--;
                } else {
                    img.src = pictures[pictures.length - 1];
                    contador = pictures.length - 1;
                }

            } else if (tgt == adelante) {
                if (contador < pictures.length - 1) {
                    img.src = pictures[contador + 1];
                    contador++;
                } else {
                    img.src = pictures[0];
                    contador = 0;
                }
            }

        });
    }

    let loadingSpinner = document.getElementById("loading-spinner")
    let latitude
    let longitude

    let miUbi = L.icon({
        iconUrl: 'https://png.pngtree.com/png-vector/20230130/ourmid/pngtree-location-home-icon-pin-deal-clipart-png-image_6575743.png',

        iconSize: [44, 46], // size of the icon
        shadowSize: [50, 64], // size of the shadow
        iconAnchor: [22, 44], // point of the icon which will correspond to marker's location
        shadowAnchor: [4, 62], // the same for the shadow
        popupAnchor: [-3, -76] // point from which the popup should open relative to the iconAnchor
    })


    document.addEventListener("DOMContentLoaded", () => {
        let contenedor = document.querySelector('.carrusel');
        carrusel(contenedor);

        /* codigo del mapa */

        const locationInfo = document.getElementById("location-info")
        loadingSpinner.style.display = "block"

        if ("geolocation" in navigator) {

            new Promise((resolve, reject) => {
                    navigator.geolocation.getCurrentPosition(resolve, reject);
                })
                .then((position) => {
                    loadingSpinner.style.display = "none"

                    let l1 = position.coords.latitude
                    let l2 = position.coords.longitude
                    /* let l1 = {{ l1 }}
                    let l2 = {{ l2 }} */

                    let map = L.map('map').setView([l1, l2], 16) //centra el mapa

                    let marker = L.marker([l1, l2], {
                        icon: miUbi
                    }).addTo(map) //agrega un marcador con mi ubicacion
                    marker.bindPopup('{{ D.dir_inmueble }}', {
                        offset: [3, 45]
                    })
                    marker.on('click', () => {
                        this.openPopup()
                    })

                    L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
                        maxZoom: 19,
                        attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
                    }).addTo(map)

                    /* let puntos = JSON.parse(document.getElementById('puntos_json').textContent)

                    puntos.forEach(P => {
                        L.marker([P.latitude, P.longitude]).addTo(map)
                    }) */

                    map.on('click', (e) => {
                        let popup = L.popup()
                            .setLatLng([e.latlng.lat, e.latlng.lng])
                            .setContent('<p>Seleccionaste<br />esta Propiedad!</p>')
                            .openOn(map)
                        L.marker([e.latlng.lat, e.latlng.lng]).addTo(map)
                        console.log(e.latlng)
                    })

                    // Aquí puedes continuar con el código que depende de la ubicación
                })
                .catch((error) => {
                    loadingSpinner.style.display = "none"
                    console.log("Error al obtener la ubicación: ")
                })

        } else {
            loadingSpinner.style.display = "none"
            locationInfo.innerHTML = "Geolocalización no está disponible en este navegador."
        }
    });
</script>
{% endfor %}
{% endblock%}